fun = "mean",
allow_na = 100,
period = "annually",
col_name = "Value")
yearly %>%
hm_plot(slot_name = "qd",
col_name = list("Value_mean"))  +
xlab("") + ylab("Annual discharge (m³/s)") +  theme(legend.position="none")
yearly <- hm_agg(station_data,
slot_name = "qd",
fun = "mean",
allow_na = 100,
period = "annually",
col_name = "Value")
yearly %>%
hm_plot(slot_name = "qd",
col_name = list("Value_mean"))  +
xlab("") + ylab("Annual discharge (m³/s)") +  theme(legend.position="none")
yearly <- hm_agg(station_data,
slot_name = "qd",
fun = "mean",
period = "annually",
col_name = "Value")
yearly %>%
hm_plot(slot_name = "qd",
col_name = list("Value_mean"))  +
xlab("") + ylab("Annual discharge (m³/s)") +  theme(legend.position="none")
library(tidyhydat)
library(dplyr)
library(hydrotoolkit)
library(ggplot2)
# Smith Creek near Marchwell, in Saskatchewan
station_number <- "05ME007"
daily_vals <-
hy_daily_flows(station_number) %>%
as.data.frame()
station_data <-
hm_create() %>%
hm_set(qd = daily_vals[ , c("Date", "Value")])
meta_data <- hy_stations(station_number)
station_data <- hm_set(station_data,
id = meta_data$STATION_NUMBER[1],
station = meta_data$STATION_NAME[1],
country = "Canada",
lat = meta_data$LATITUDE[1],
long = meta_data$LONGITUDE[1],
province = meta_data$PROV_TERR_STATE_LOC[1],
active = (meta_data$HYD_STATUS[1] == "ACTIVE"),
basin_area = meta_data$DRAINAGE_AREA_GROSS[1],
basin_eff = meta_data$DRAINAGE_AREA_EFFECT[1],
other_1 = paste("RHBN:", meta_data$RHBN[1]))
hm_plot(obj = station_data, slot_name = "qd", col_name = list("Value"))
p <- hm_plot(obj = station_data, slot_name = "qd", col_name = list("Value"))
p <- p + xlab("") + ylab("Daily discharge (m³/s)") +  theme(legend.position="none")
p
hm_plot(obj = station_data, slot_name = "qd", col_name = list("Value")) +
xlab("") + ylab("Daily discharge (m³/s)") +  theme(legend.position="none")
p <- hm_plot(obj = station_data, slot_name = "qd", col_name = list("Value"))
p <- hm_plot(obj = station_data, slot_name = "qd", col_name = list("Value"))
p
hm_plot(obj = station_data, slot_name = "qd", col_name = list("Value"))
p <- hm_plot(obj = station_data, slot_name = "qd", col_name = list("Value"))
p <- p +  xlab("") + ylab("Daily discharge (m³/s)") +  theme(legend.position="none")
p
devtools::load_all(".")
monthly <- hm_agg(station_data,
slot_name = "qd",
fun = "mean",
period = "monthly",
col_name = "Value")
monthly %>%
hm_plot(slot_name = "qd",
col_name = list("Value_mean")
)
p <- hm_plot(obj = station_data, slot_name = "qd", col_name = list("Value")) +  xlab("") + ylab("Daily discharge (m³/s)") +  theme(legend.position="none")
p
install.packages("learnr")
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
p <- hm_plot(obj = station_data, slot_name = "qd", col_name = list("Value")) +  xlab("") + ylab("Daily discharge (m³/s)") +  theme(legend.position="none")
devtools::load_all(".")
yearly <- hm_agg(station_data,
slot_name = "qd",
fun = "mean",
allow_na = 100,
period = "annually",
col_name = "Value")
yearly %>%
hm_plot(slot_name = "qd",
col_name = list("Value_mean"))  +
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(tidyhydat)
library(dplyr)
library(hydrotoolkit)
library(ggplot2)
# Smith Creek near Marchwell, in Saskatchewan
station_number <- "05ME007"
daily_vals <-
hy_daily_flows(station_number) %>%
as.data.frame()
station_data <-
hm_create() %>%
hm_set(qd = daily_vals[ , c("Date", "Value")])
meta_data <- hy_stations(station_number)
station_data <- hm_set(station_data,
id = meta_data$STATION_NUMBER[1],
station = meta_data$STATION_NAME[1],
country = "Canada",
lat = meta_data$LATITUDE[1],
long = meta_data$LONGITUDE[1],
province = meta_data$PROV_TERR_STATE_LOC[1],
active = (meta_data$HYD_STATUS[1] == "ACTIVE"),
basin_area = meta_data$DRAINAGE_AREA_GROSS[1],
basin_eff = meta_data$DRAINAGE_AREA_EFFECT[1],
other_1 = paste("RHBN:", meta_data$RHBN[1]))
hm_plot(obj = station_data, slot_name = "qd", col_name = list("Value"))
p <- hm_plot(obj = station_data, slot_name = "qd", col_name = list("Value")) +  xlab("") + ylab("Daily discharge (m³/s)") +  theme(legend.position="none")
p
monthly <- hm_agg(station_data,
slot_name = "qd",
fun = "mean",
period = "monthly",
col_name = "Value")
monthly %>%
hm_plot(slot_name = "qd",
col_name = list("Value_mean")
)
yearly <- hm_agg(station_data,
slot_name = "qd",
fun = "mean",
allow_na = 100,
period = "annually",
col_name = "Value")
yearly %>%
hm_plot(slot_name = "qd",
col_name = list("Value_mean"))  +
yearly <- hm_agg(station_data,
slot_name = "qd",
fun = "mean",
allow_na = 100,
period = "annually",
col_name = "Value")
yearly %>%
hm_plot(slot_name = "qd",
col_name = list("Value_mean"))
library(hydrotoolkit)
devtools::load_all(".")
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(weathercan)
install.packages("weathercan")
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(weathercan)
library(hydrotoolkit)
# get station ID's
head(stations)
# search by name
stations_search("Kamloops", interval = "day")
# Kamloops A - BC province
station_id <- 1274
# because hydrotoolkit works with data frames
# we convert the tibble
kam <-
weather_dl(station_ids = station_id,
start = "1900-01-01",
end = "1950-12-31",
interval = "day") %>%
as.data.frame()
# now we create the station object adn we set the data
kamloops_hm <-
hm_create() %>%
hm_set(id = station_id,
station = kam$station_name[1],
province = kam$prov[1],
country = "Canada",
lat = kam$lat[1],
long = kam$lon[1],
alt = kam$elev[1],
tmean = kam[ , c("date", "mean_temp")],
tmax = kam[ , c("date", "max_temp")],
tmin = kam[ , c("date", "min_temp")],
precip = kam[ , c("date", "total_precip")],
rainfall = kam[ , c("date", "total_rain")]
)
kamloops_hm %>% hm_show()
# we plot air temperatures
kamloops_hm %>%
hm_plot(slot_name = c('tmean', 'tmax', 'tmin'),
col_name = list('mean_temp', 'max_temp', 'min_temp'),
interactive = TRUE,
line_color = c('forestgreen', 'red', 'dodgerblue'),
x_lab = 'Date', y_lab = 'T(ºC)',
legend_lab = c('mean', 'max', 'min') )
# before running this function, the packages
# weathercan and hydrotoolkit should be loaded
# station_number: character with station ID
build_weathercan <- function(station_id,
from, to,
time_step){
# download station data
station <-
weather_dl(station_ids = station_id,
start = from,
end = to,
interval = time_step) %>%
as.data.frame()
# now we create the station object and we set the (meta)data
station_hm <-
hm_create() %>%
hm_set(id = station_id,
station = station$station_name[1],
province = station$prov[1],
country = "Canada",
lat = station$lat[1],
long = station$lon[1],
alt = station$elev[1],
tmean = station[ , c("date", "mean_temp")],
tmax = station[ , c("date", "max_temp")],
tmin = station[ , c("date", "min_temp")],
precip = station[ , c("date", "total_precip")],
rainfall = station[ , c("date", "total_rain")]
)
return(station_hm)
}
# we construct the Kamloops station
# but in a single code line
kamloops_station <-
build_weathercan(station_id = 1274,
from = "1900-01-01",
to = "1950-12-31",
time_step = "day")
kamloops_station %>%
hm_show()
View(kamloops_hm)
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "Value")
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "total_precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "Value")
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "Value")
View(kamloops_station)
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "Value")
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "Value")
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "mean",
allow_na = 100,
period = "annually",
col_name = "Value")
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "tair",
fun = "mean",
allow_na = 100,
period = "annually",
col_name = "Value")
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "tmax",
fun = "mean",
allow_na = 100,
period = "annually",
col_name = "Value")
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "Value")
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "Value")
View(kamloops_station)
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "total_precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "Value")
kamloops_yearly <- hm_agg(kamloops_station,
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(weathercan)
library(hydrotoolkit)
# get station ID's
head(stations)
# search by name
stations_search("Kamloops", interval = "day")
# Kamloops A - BC province
station_id <- 1274
# because hydrotoolkit works with data frames
# we convert the tibble
kam <-
weather_dl(station_ids = station_id,
start = "1900-01-01",
end = "1950-12-31",
interval = "day") %>%
as.data.frame()
# now we create the station object adn we set the data
kamloops_hm <-
hm_create() %>%
hm_set(id = station_id,
station = kam$station_name[1],
province = kam$prov[1],
country = "Canada",
lat = kam$lat[1],
long = kam$lon[1],
alt = kam$elev[1],
tmean = kam[ , c("date", "mean_temp")],
tmax = kam[ , c("date", "max_temp")],
tmin = kam[ , c("date", "min_temp")],
precip = kam[ , c("date", "total_precip")],
rainfall = kam[ , c("date", "total_rain")]
)
kamloops_hm %>% hm_show()
# we plot air temperatures
kamloops_hm %>%
hm_plot(slot_name = c('tmean', 'tmax', 'tmin'),
col_name = list('mean_temp', 'max_temp', 'min_temp'),
interactive = TRUE,
line_color = c('forestgreen', 'red', 'dodgerblue'),
x_lab = 'Date', y_lab = 'T(ºC)',
legend_lab = c('mean', 'max', 'min') )
# before running this function, the packages
# weathercan and hydrotoolkit should be loaded
# station_number: character with station ID
build_weathercan <- function(station_id,
from, to,
time_step){
# download station data
station <-
weather_dl(station_ids = station_id,
start = from,
end = to,
interval = time_step) %>%
as.data.frame()
# now we create the station object and we set the (meta)data
station_hm <-
hm_create() %>%
hm_set(id = station_id,
station = station$station_name[1],
province = station$prov[1],
country = "Canada",
lat = station$lat[1],
long = station$lon[1],
alt = station$elev[1],
tmean = station[ , c("date", "mean_temp")],
tmax = station[ , c("date", "max_temp")],
tmin = station[ , c("date", "min_temp")],
precip = station[ , c("date", "total_precip")],
rainfall = station[ , c("date", "total_rain")]
)
return(station_hm)
}
# we construct the Kamloops station
# but in a single code line
kamloops_station <-
build_weathercan(station_id = 1274,
from = "1900-01-01",
to = "1950-12-31",
time_step = "day")
kamloops_station %>%
hm_show()
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "Value")
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "total_precip")
kamloops_yearly %>%
hm_plot(slot_name = "precip",
col_name = list("total_precip"))
kamloops_yearly %>%
hm_plot(slot_name = "precip",
col_name = list("total_precip_sum"))
```{r}
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "total_precip")
kamloops_yearly %>%
hm_plot(slot_name = "precip",
col_name = list("total_precip_sum"))
?hm_plot
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "total_precip")
kamloops_yearly %>%
hm_plot(slot_name = "precip",
col_name = list("total_precip_sum")) +
xlab("") +
ylab("Annual precipitaion (mm)") +
theme(legend.position="none")
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "total_precip")
p <- kamloops_yearly %>%
hm_plot(slot_name = "precip",
col_name = list("total_precip_sum")) +
xlab("") +
ylab("Annual precipitaion (mm)") +
theme(legend.position="none")
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "total_precip")
p <- hm_plot(obj = kamloops_yearly,
slot_name = "precip",
col_name = list("total_precip_sum")) +
xlab("") +
ylab("Annual precipitaion (mm)") +
theme(legend.position="none")
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "total_precip")
p <- hm_plot(obj = kamloops_yearly,
slot_name = "precip",
col_name = list("total_precip_sum")) +
xlab("") +
ylab("Annual precipitaion (mm)") +
theme(legend.position="none")
library(weathercan)
library(hydrotoolkit)
library(ggplot2)
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "total_precip")
p <- hm_plot(obj = kamloops_yearly,
slot_name = "precip",
col_name = list("total_precip_sum")) +
xlab("") +
ylab("Annual precipitaion (mm)") +
theme(legend.position="none")
p
kamloops_yearly <- hm_agg(kamloops_station,
slot_name = "precip",
fun = "sum",
allow_na = 100,
period = "annually",
col_name = "total_precip")
p <- hm_plot(obj = kamloops_yearly,
slot_name = "precip",
col_name = list("total_precip_sum")) +
xlab("") +
ylab("Annual precipitaion (mm)") +
theme(legend.position="none") +
ggtitle("Kamloops annual precipitation")
p
infile <- "../../CRHMr/test_data/refactored_CRHM_output_1.obs"
source('~/data/projects/R_packages/CRHMr/CRHMr/R/readExportFile.R')
devtools::load_all(".")
source('~/data/projects/R_packages/CRHMr/CRHMr/R/readExportFile.R')
a <- readExportFile(infile, timezone = "Etc/GMT+6")
View(a)
library(CRHMr)
